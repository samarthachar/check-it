{% extends 'base.html' %}

{% block content %}

<div class="bg-dark text-secondary px-4 py-5 text-center" xmlns="http://www.w3.org/1999/html">
   <div class="py-5">
      <h1 class="display-5 fw-bold text-white">{{ name }}</h1>

   </div>
</div>
<div class="d-flex flex-column flex-md-row p-4 gap-4 py-md-5 align-items-center justify-content-center ">
   <div class="list-group col-6">
      {% for box_id, (title, description, checked) in data.items(): %}
      <label class="list-group-item d-flex gap-3">
         {% if checked %}
            <input class="form-check-input flex-shrink-0" type="checkbox" checked style="font-size: 1.375em;" id="{{ box_id }}">
         {% else %}
            <input class="form-check-input flex-shrink-0" type="checkbox"  style="font-size: 1.375em;" id="{{ box_id }}">
         {% endif %}
         <span class="pt-1 form-checked-content">

            <strong>
               {% if checked %} <s> {% endif %}{{ title }}{% if checked %} </s> {% endif %}</strong>
            <small class="d-block text-body-secondary">
               {% if checked %} <s> {% endif %}{{ description}}{% if checked %} </s> {% endif %}
            </small>

            <button class="btn p-0 position-absolute top-50 end-0 translate-middle-y" onclick="window.location.href='/{{ name }}/delete-todo/{{ box_id }}'">
               <img src="{{ url_for('static', filename='delete.svg') }}" class="d-block ms-auto pe-2" style="width: 30px; margin: 0; " alt="Delete Button">
            </button>
         </span>
      </label>
      {% endfor %}

      <label class="list-group-item d-flex gap-3 bg-body-tertiary">
         <input class="form-check-input form-check-input-placeholder bg-body-tertiary flex-shrink-0 pe-none" disabled="" type="checkbox" value="" style="font-size: 1.375em;">
         <div class="pt-1 form-checked-content">
            <form action="/todo/{{ name }}/add-todo" method="POST">
                  <input type="text" name="title" placeholder="Add new task..." class="form-control border-0 bg-transparent shadow-none">
            <div class="d-block text-body-secondary">
                  <input type="text" name="description" placeholder="Add new description..." class="form-control border-0 bg-transparent shadow-none">
            </div>
               <button type="submit" class="btn btn-light">Add Todo</button>
               </form>
         </div>
      </label>
   </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');

    checkboxes.forEach(cb => {
      cb.addEventListener('change', () => {
        // Get all currently checked checkboxes
        const checkedBoxes = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'));

        // Extract their IDs
        const checkedIds = checkedBoxes.map(box => box.id);

        // Send updated state to server
        fetch('/{{ name }}/check-tick', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ checked_ids: checkedIds })
        })
        .then(response => response.json())
        .then(data => {
          console.log("Server response:", data);
        });
      });
    });
  });
</script>

{% endblock %}